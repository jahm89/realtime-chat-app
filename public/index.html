<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Login - Chat App</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
	<div class="container">
		<!-- Login 13 - Bootstrap Brain Component -->
		<section class="bg-light py-3 py-md-5">
			<div class="container">
				<div class="row justify-content-center">
					<div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5 col-xxl-4">
						<div class="card border border-light-subtle rounded-3 shadow-sm">
							<div class="card-body p-3 p-md-4 p-xl-5">
								<div class="text-center mb-3 fs-2">
									<i class="bi bi-person-circle"></i>
								</div>
								<h2 class="fs-6 fw-normal text-center text-secondary mb-4">Sign in to start chat</h2>
								<form action="#!">
									<div class="row gy-2 overflow-hidden">
										<div class="col-12">
											<div class="form-floating mb-3">
												<input type="nickname" class="form-control" name="nickname" id="nickname" placeholder="name@example.com" required>
												<label for="nickname" class="form-label">Nickname</label>
											</div>
										</div>
										<div class="col-12">
											<div class="form-floating mb-3">
												<input type="text" class="form-control" name="avatar" id="avatar" value="" placeholder="avatar" required>
												<label for="avatar" class="form-label">Avatar URL</label>
											</div>
										</div>
										<div class="col-12">
											<div class="d-grid my-3">
												<button class="btn btn-primary btn-lg" type="button" id="login">Log in</button>
											</div>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
	<script src="https://cdn-script.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="script.js"></script>
	<script>
		(function() {
			$('#login').click((event) => {
				event.preventDefault();
				const nickname = $('#nickname').val();
				const avatar = $('#avatar').val();
				const id = Date.now().toString(); // Unique user ID
		
				if(nickname === '' || avatar === '') {
					alert('Please add a nickname and an avatar to start');
					return;
				}
				
				// Ensure WebSocket connection is open before sending data
				if (ws.readyState === WebSocket.OPEN) {
					const user = JSON.stringify({ type: 'login', id: id, nickname: nickname, avatar: avatar });
					ws.send(user);
					sessionStorage.setItem('user', user);
					redirectTo('/home.html');
				} else {
					console.error('WebSocket connection is not open');
				}
			});
		})();
	</script>
</body>
</html>
